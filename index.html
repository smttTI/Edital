<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8" />
    <title>Auto SMTT: Consulta Pública de Editais</title>
    <link rel="icon" href="smtt.png" type="smtt/png">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

    <style>
        body {
            font-family: Roboto;
            background: #ececec;
            margin: 0;
            padding: 0;
        }

        .top-header {
            display: flex;
            padding: 0px 10px;
            background-color: #052d6d;
            color: white;
            width: 100%;
            box-sizing: border-box;
            margin: 0 0 20px 0;
        }

        .logo {
            height: auto;
            width: 200px;
        }

        .top-header h1 {
            font-size: 22px;
            font-weight: bold;
            color: white;
        }

        .company-name {
            font-size: 30px;
            margin-left: 10px;
            display: flex;
            align-items: center;
            letter-spacing: -1px;
        }

        .container {
            max-width: 1100px;
            background: #fff;
            border: 1px solid #ccc;
            padding: 20px;
            margin: auto;
            border-radius: 3px;
            max-height: 80vh;
            overflow-y: auto;
        }

        .header {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 20px;
        }

        .box {
            background: #e5f3f9;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 15px;
        }

        input[type="text"] {
            width: 1075px;
            padding: 10px;
            margin-top: 10px;
            margin-bottom: 15px;
            border-radius: 4px;
            border: 1px solid #ccc;
        }

        input:invalid {
            border-color: rgba(224, 224, 224, 0.699);
            background-color: #ffffff;
        }

        .btn {
            background: #33aadd;
            color: #fff;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
        }

        .btn:hover {
            background: #0879a9;
            color: #ffffff;
        }

        .btn2 {
            color: #5e5e5e;
            border: none;
            padding: 5px 10px;
            border-radius: 5px;
            cursor: pointer;
            background-color: #fff;
        }

        .btn2:hover {
            background-color: #49494911;
            color: rgb(0, 0, 0);
        }

        .results {
            margin-top: 20px;
        }

        .result-item {
            background: rgb(250, 250, 255);
            padding: 10px;
            margin-bottom: 10px;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .result-text {
            flex: 1;
        }

        .download-link {
            font-size: 24px;
            text-decoration: none;
        }

        footer {
            position: fixed;
            background-color: #f5ca0c;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 45px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 10px;
            color: #292929;
        }

        .company-footer {
            font-size: small;
            font-weight: bold;
        }

        .version-footer {
            font-size: smaller;
            margin-right: 20px;
        }

        .download-link {
            padding: 6px;
            border-radius: 3px;
            background-color: #fce4ec;
            display: inline-block;
        }

        .download-link:hover {
            background-color: #f8bbd0;
        }

        .input-group {
            display: flex;
            gap: 10px;
        }

        .input-group input {
            flex: 1;
        }

        #loading {
            width: 100%;
            height: 10px;
            margin-top: 20px;
            background-color: #e0e0e0;
            border-radius: 5px;
        }

        #loading::-webkit-progress-bar {
            background-color: #f0f0f0;
            border-radius: 5px;
        }

        #loading::-webkit-progress-value {
            background-color: #33aadd;
            border-radius: 5px;
        }

        #loading::-moz-progress-bar {
            background-color: #2783aa;
            border-radius: 5px;
        }

        #campoData {
            display: flex;
            gap: 20px;
        }

        .input-group {
            display: flex;
            align-items: center;
            width: 100%;
            gap: 5px;
        }

        .floating-label {
            margin-right: 3px;
            color: #000000;
        }

        input[type="date"] {
            flex-grow: 1;
        }

        .input-group input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .input-group input::placeholder {
            color: #aaaaaa;
            font-style: italic;
        }
    </style>
</head>

<body>

   
    <div class="container">
        <div class="header"><i class="fa fa-search"></i> Consultar Editais</div>
         <p>Para consultar editais de notificação de Autuação, de Penalidade de Multa e Penalidade de Advertência por Escrito por Infração de Trânsito, pesquise nos campos abaixo.</p> 
        <hr>
        <form onsubmit="buscar(event)" novalidate>
            <div class="box">
                <label>Informe o tipo de argumento pelo qual deseja pesquisar:</label><br />
                <input type="radio" name="tipo" value="placa" checked> Placa
                <input type="radio" name="tipo" value="numero"> Número do Auto
                <input type="radio" name="tipo" value="data"> Data de Cometimento
            </div>
            <label id="inputLabel">Placa</label>
            <div id="campoBusca">
                <input type="text" id="inputBusca" name="inputBusca" placeholder="Digite o valor..." required />
            </div>
            <small id="placaAviso" style="color: red; display: none;">* Digite apenas letras e números, sem
                hífen.</small>
            <div id="campoData" style="display: none;">
                <div class="input-group">
                    <label for="dataInicio" class="floating-label">De:</label>
                    <input type="date" id="dataInicio" name="dataInicio" placeholder="De">
                </div>
                <div class="input-group">
                    <label for="dataFim" class="floating-label">Até:</label>
                    <input type="date" id="dataFim" name="dataFim" placeholder="Até">
                </div>
            </div>
            <button type="submit" class="btn"><i class="fa fa-search"></i> Pesquisar</button>
        </form>
        <div id="loading-container" style="display: none;">
            <progress id="loading" value="0" max="100"></progress>
            <span>Carregando...</span>
        </div>
        <div class="results" id="resultados"></div>
    </div>

    <footer class="footer">
        <span class="company-footer">Auto SMTT</span>
        <span class="version-footer">versão: 1.0.2</span>
    </footer>

    <script>
        let dados = [];

        function alterarLabel() {
            const radioButtons = document.querySelectorAll('input[name="tipo"]');
            const labelBusca = document.getElementById('inputLabel');
            const campoBusca = document.getElementById('campoBusca');
            const campoData = document.getElementById('campoData');

            radioButtons.forEach(radio => {
                radio.addEventListener('change', () => {
                    if (radio.checked) {
                        labelBusca.textContent = radio.value === 'data'
                            ? 'Período'
                            : radio.value.charAt(0).toUpperCase() + radio.value.slice(1);
                        campoBusca.style.display = (radio.value === 'data') ? 'none' : 'block';
                        campoData.style.display = (radio.value === 'data') ? 'flex' : 'none';
                    }
                });
            });
        }

        function toISODate(str) {
            if (!str) return "";
            const s = ("" + str).trim();

            if (/^\d{4}[-\/]\d{2}[-\/]\d{2}$/.test(s)) {
                const [y, m, d] = s.split(/[-\/]/);
                return y + m + d;
            }

            if (/^\d{2}[-\/]\d{2}[-\/]\d{4}$/.test(s)) {
                const [d, m, y] = s.split(/[-\/]/);
                return y + m + d;
            }

            if (/^\d{8}$/.test(s)) {
                const yFirst = s.slice(0, 4);
                const likelyYear = parseInt(yFirst, 10);
                if (likelyYear >= 1900) {
                    return s;
                } else {
                    const d = s.slice(0, 2), m = s.slice(2, 4), y = s.slice(4, 8);
                    return y + m + d;
                }
            }

            const parts = s.split(/[^0-9]/).filter(Boolean);
            if (parts.length === 3) {
                let [a, b, c] = parts;
                if (a.length === 4) return a + b.padStart(2, '0') + c.padStart(2, '0');
                if (c.length === 4) return c + b.padStart(2, '0') + a.padStart(2, '0');
            }
            return "";
        }

        function inputDateToISO(value) {
            if (!value) return "";
            const [y, m, d] = value.split("-");
            return (y && m && d) ? (y + m + d) : "";
        }

        function carregarCSV() {
    const urlCSV = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vQNP5xtXGSB2YK9s50apLumlJLk2S-HuhWqfmUQkFDmwT1Rv6FS-fl4KXmHa7oY4q9LFTQDnk60y8Te/pub?output=csv';

    fetch(urlCSV)
        .then(response => response.text())
        .then(text => {
            dados = processarCSV(text);
            console.log("Dados processados:", dados);
        })
        .catch(error => console.error('Erro ao carregar CSV:', error));
}



        function processarCSV(csv) {
            const linhas = csv.split('\n');
            const resultado = [];

            for (let i = 1; i < linhas.length; i++) {
                const colunas = linhas[i].split(',');

                if (colunas.length > 1) {
                    const placa = (colunas[0] || "").replace(/"/g, '').trim();
                    const numero = (colunas[1] || "").replace(/"/g, '').trim();
                    const dataBruta = (colunas[2] || "").replace(/"/g, '').trim();
                    const codigo = (colunas[3] || "").replace(/"/g, '').trim();
                    const lote = (colunas[4] || '').replace(/"/g, '').trim().replace(/\r/g, '');
                    const pdfLink = (colunas[5] || '').replace(/"/g, '').trim();

                    const dataISO = toISODate(dataBruta);

                    resultado.push({ placa, numero, data: dataBruta, dataISO, codigo, lote, pdfLink });
                }
            }
            return resultado;
        }

        function buscar(event) {
            event.preventDefault();

            const tipo = document.querySelector('input[name="tipo"]:checked').value;
            const dataInicioEl = document.getElementById('dataInicio');
            const dataFimEl = document.getElementById('dataFim');
            const inputBusca = document.getElementById('inputBusca');

            const isDataSearch = (tipo === 'data');
            const isValid =
                (isDataSearch && dataInicioEl.value.trim() !== '' && dataFimEl.value.trim() !== '') ||
                (!isDataSearch && inputBusca.value.trim() !== '');

            if (!isValid) return;

            const loadingElement = document.getElementById("loading-container");
            loadingElement.style.display = "block";

            let encontrados = [];

            if (isDataSearch) {
                let inicio = inputDateToISO(dataInicioEl.value.trim());
                let fim = inputDateToISO(dataFimEl.value.trim());

                if (inicio && fim && inicio > fim) [inicio, fim] = [fim, inicio];

                encontrados = dados.filter(item => {
                    const d = item.dataISO || "";
                    return d && d >= inicio && d <= fim;
                }).sort((a, b) => a.dataISO.localeCompare(b.dataISO));
            } else {
                const valor = inputBusca.value.trim().toLowerCase();
                encontrados = (tipo === 'numero')
                    ? dados.filter(item => (item.numero || '').toLowerCase().includes(valor))
                    : dados.filter(item => (item.placa || '').toLowerCase().includes(valor));
            }

            const resultados = document.getElementById('resultados');
            const loadingBar = document.getElementById("loading");
            let progress = 0;

            const interval = setInterval(function () {
                progress += 2;
                if (progress > 100) progress = 100;
                loadingBar.value = progress;

                if (progress >= 100) {
                    clearInterval(interval);

                    resultados.innerHTML = encontrados.length
                        ? encontrados.map(item =>
                            `<div class="result-item">
                              <div class="result-text">
                                <strong>Placa:</strong> ${item.placa}<br />
                                <strong>Número do Auto:</strong> ${item.numero}<br />
                                <strong>Data de Cometimento:</strong> ${formatarDataBr(item.dataISO)}<br />
                                <strong>Código da Infração:</strong> ${item.codigo || '-'}
                              </div>
                              ${item.pdfLink ? `
                              <a href="${item.pdfLink}" target="_blank"
                                 class="download-link" title="Baixar PDF"
                                 style="display: flex; align-items: center; gap: 4px;">
                                 <small style="font-size: 10px;">PDF</small>
                                 <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="#d32f2f" viewBox="0 0 24 24">
                                   <path d="M6 2a2 2 0 0 0-2 2v16c0 1.103.897 2 2 2h12a2 2 0 0 0 2-2V8l-6-6H6zm7 1.414L18.586 9H13V3.414zM8 13h1.5v6H8v-6zm3 .5c0-.276.224-.5.5-.5h1.5a1.5 1.5 0 1 1 0 3H12v3h-1.5v-6zm1.5 2c.276 0 .5-.224.5-.5s-.224-.5-.5-.5H12v1h.5zM17 13h-2v6h2a1 1 0 0 0 1-1v-4a1 1 0 0 0-1-1zm-.5 5h-0.5v-4h0.5v4z"/>
                                 </svg>
                              </a>` : `<span style="color:gray;font-size:12px;">Sem PDF</span>`}
                            </div>`
                        ).join('')
                        : '<div class="result-item">Nenhum resultado encontrado.</div>';

                    loadingElement.style.display = "none";
                }
            }, 20);
        }

        window.onload = function () {
            carregarCSV();
            alterarLabel();
        };

        function formatarDataBr(iso) {
            if (!iso || iso.length !== 8) return iso || "-";
            const ano = iso.substring(0, 4);
            const mes = iso.substring(4, 6);
            const dia = iso.substring(6, 8);
            return `${dia}/${mes}/${ano}`;
        }
    </script>

</body>
</html>







